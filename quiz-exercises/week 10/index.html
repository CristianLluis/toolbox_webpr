<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
</head>

<body>
	<script>
		// object Promise
		// const idPromise = x => new Promise (resolve => resolve(x));		
		// document.writeln(idPromise(1))

		/********************************************************************************/
		// const idPromise = x => new Promise (resolve => resolve(x));		

		// const writer = x => {
		// 	document.writeln(x)
		// 	return idPromise(x)
		// }

		// const filterEven = n => { if ( n % 2 === 0) return n; else throw Error("not even")} 

		// idPromise(1)
		// 	.then(writer)
		// 	.then(filterEven)
		// 	.then(writer)
		// 	.catch(err => {})

		/********************************************************************************/

		// const idPromise = x => new Promise (resolve => resolve(x));		

		// const writer = x => {
		// 	document.writeln(x)
		// 	return idPromise(x)
		// }

		// idPromise(1)
		// 	.then(writer)
		// 	.then(it => it + 1)
		// 	.then(writer)

		/********************************************************************************/

		//shows: 1 undefined // no error in console
		// const idPromise = x => new Promise (resolve => resolve(x));		

		// const writer = x => {
		// 	document.writeln(x)
		// 	return idPromise(x)
		// }

		// const filterEven = n => n % 2 === 0 ? n : undefined

		// idPromise(1)
		// 	.then(writer)
		// 	.then(filterEven)
		// 	.then(writer)

		/********************************************************************************/


		// const idPromise = x => new Promise (resolve => resolve(x));		

		// const writer = x => {
		// 	document.writeln(x)
		// 	return idPromise(x)
		// }

		// const inc = n => n + 1
		// const filterEven = n => n % 2 === 0 ? n : undefined

		// idPromise(1)
		// 	.then(writer)
		// 	.then(inc)
		// 	.then(writer)
		// 	.then(filterEven)
		// 	.then(writer)

		/********************************************************************************/

		// const idPromise = x => new Promise (resolve => resolve(x));		

		// idPromise(1)
		// 	.then(it => document.writeln(it))


		// /********************************************************************************/


		// 		const idPromise = x => new Promise (resolve => resolve(x));		

		// 		const writer = x => {
		// 			document.writeln(x)
		// 			return idPromise(x)
		// 		}

		// 		idPromise(1)
		// 			.then(writer)
		// 			.then(it => it+1)
		// 			.then(writer)


		/********************************************************************************/

		//start async await

		// const idPromise = x => new Promise (resolve => resolve(x));
		// const failPromise = err => new Promise((resolve, reject) => reject(err))		

		// const writer = x => {
		// 	document.writeln(x)
		// 	return idPromise(x)
		// }

		// const inc = n => idPromise(n+1)

		// const foo = async i => {
		// 	let x = await idPromise(1)
		// 	while(x < 4) {
		// 		x = await writer(x)
		// 		x = await inc(x)
		// 	}
		// }
		// foo(1)

		/********************************************************************************/

		// const idPromise = x => new Promise (resolve => resolve(x));
		// const failPromise = err => new Promise((resolve, reject) => reject(err))		

		// const writer = x => {
		// 	document.writeln(x)
		// 	return idPromise(x)
		// }

		// const foo = async i => {
		// 	let x = await idPromise(1)
		// 	x = await writer(x)
		// }
		// foo(1)

		/********************************************************************************/
		// const idPromise = x => new Promise (resolve => resolve(x));
		// const failPromise = err => new Promise((resolve, reject) => reject(err))		

		// const writer = x => {
		// 	document.writeln(x)
		// 	return idPromise(x)
		// }

		// const inc = n => idPromise(n+1)
		// const filterEven = n => n % 2 === 0 ? idPromise(n): failPromise('not even')

		// const foo = async i => {
		// 	let x = await idPromise(1)
		// 	while(x < 4) {
		// 		x = await filterEven(x)
		// 		x = await writer(x)
		// 		x = await inc(x)
		// 	}
		// }
		// foo(1)

		// /********************************************************************************/

		// const idPromise = x => new Promise (resolve => resolve(x));
		// const failPromise = err => new Promise((resolve, reject) => reject(err))		

		// const writer = x => {
		// 	document.writeln(x)
		// 	return idPromise(x)
		// }

		// const foo = async i => {
		// 	let x = await idPromise(1)
		// 	x.then(writer)
		// }
		// foo(1)

		/********************************************************************************/

		// const idPromise = x => new Promise (resolve => resolve(x));
		// const failPromise = err => new Promise((resolve, reject) => reject(err))		

		// const foo = async i => {
		// 	let x = await idPromise(1)
		// 	document.writeln(x)
		// }
		// foo(1)

		/********************************************************************************/

		// const idPromise = x => new Promise (resolve => resolve(x));
		// const failPromise = err => new Promise((resolve, reject) => reject(err))		

		// const writer = x => {
		// 	document.writeln(x)
		// 	return idPromise(x)
		// }

		// const inc = n => idPromise(n+1)
		// const filterEven = n => n % 2 === 0 ? idPromise(n): failPromise('not even')

		// const foo = async i => {
		// 	let x = await idPromise(i)
		// 	while(x < 4) {
		// 		x = await filterEven(x).catch(err => {})
		// 		x = await writer(x)
		// 		x = await inc(x)
		// 	}
		// }
		// foo(1)

		// const NullSafe = x => {
		// 	const isNullSafe = y => y && y.then;
		// 	const maywrap = y => isNullSafe(y) ? y : new Promise((resolve, reject) => y ? resolve(y) : reject()); // if y is not NullSafe yet, make it so
		// 	return {
		// 		then: fn => {
		// 			maywrap(x).then(fn).catch(() => {})
		// 			//if (x !== null || x !== undefined) {}

		// 		} // see(1)
		// 	}
		// };

		/********************************************************************************/
		// const idPromise = x => new Promise (resolve => resolve(x));
		// const failPromise = err => new Promise((resolve, reject) => reject(err))
		const NullSafe = x => {
			const isNullSafe = y => y && y.then;
			const maywrap = y => isNullSafe(y) ? new Promise (resolve => resolve(y)) : new Promise((resolve, reject) => reject()) // if y is not NullSafe yet, make it so
			return {
				then: fn => maywrap(x).then(fn).catch(() => {}) // see(1)
			}
		};

		// x_ and y_ are given. do not override.
		let x_ = 1
		let y_ = 3
		console.log(
			NullSafe(x_)
				.then(x => x * 2)          // must auto-promote
				.then(x => NullSafe(x))  // must not auto-promote
				.then(x => y_ = x + 1)   // store value, check no double promotion
				.then(x => null)         // jump over rest
				.then(x => x.mustNotBeCalled) !== null && y_ === x_ * 2 + 1
		)




	</script>
</body>

</html>
